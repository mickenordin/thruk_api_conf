## Configuration Editor Thruk Plugin for Icinga2

This plugin allows you to configure Icinga2 via the in built HTTP API.

This plugin is free software, you can redistribute it and/or modify
it under the same terms as Perl itself.

Dependencies for ubuntu 16.04 is: 
libcgi-pm-perl libconfig-json-perl libdata-validate-ip-perl liblwp-protocol-https-perl libnet-sslglue-perl libtest-json-perl
  
Install instructions:
cd plugins-available
git clone https://github.com/stockholmuniversity/thruk-plugin-configeditor.git configuration_editor

In order to work the plugin needs a config file in json format which is typicaly called:
/etc/thruk/icinga-api-credentials.json

Filename of the config file is hardcoded but the path is guessed from
$c->stash->{usercontent_folder} by using dirname on the variable.  
Content of this file should contain credentials and host/port information, e.g: 

{
   "user" : "myuser",
   "password" : "secret",
   "realm" : "Icinga 2",
   "host" : "icinga.example.com",
   "port" : "5665",
   "path" : "v1",
}

If you want to get access to plugin actions from the action menu you can add this to thruk_local.conf:

<action_menu_items>
    hostmenu = {\
       "icon": "/thruk/themes/{{theme}}/images/dropdown.png",\
       "title": "Host Menu",\
       "menu": [\
            {\
               "icon": "/thruk/themes/{{theme}}/images/delete.png",\
               "label": "Delete Host",\
               "action": "/thruk/cgi-bin/api_conf.cgi?page_type=hosts&mode=delete&host=$HOSTNAME$"\
            },\
            {\
               "icon": "/thruk/themes/{{theme}}/images/add.png",\
               "label": "Add Service to Host",\
               "action": "/thruk/cgi-bin/api_conf.cgi?page_type=services&mode=create&host=$HOSTNAME$"\
            },\
            {\
               "icon": "/thruk/themes/{{theme}}/images/edit.png",\
               "label": "Modify Host",\
               "action": "/thruk/cgi-bin/api_conf.cgi?page_type=hosts&mode=modify&host=$HOSTNAME$"\
            },\
       ]\
    }
    servicemenu = {\
       "icon": "/thruk/themes/{{theme}}/images/dropdown.png",\
       "title": "Service Menu",\
       "menu": [\
           {\
               "icon": "/thruk/themes/{{theme}}/images/delete.png",\
               "label": "Delete Service",\
               "action": "/thruk/cgi-bin/api_conf.cgi?page_type=services&mode=delete&host=$HOSTNAME$&service=$SERVICEDESC$"\
           },\
           {\
               "icon": "/thruk/themes/{{theme}}/images/edit.png",\
               "label": "Modify Service",\
               "action": "/thruk/cgi-bin/api_conf.cgi?page_type=services&mode=modify&host=$HOSTNAME$&service=$SERVICEDESC$"\
           },\
       ]\
    }
</action_menu_items>

<action_menu_actions>
</action_menu_actions>

<action_menu_apply>
    hostmenu    = .*;$             # matches all hosts only
    servicemenu = .*;.+$           # matches all services on all hosts
</action_menu_apply>

